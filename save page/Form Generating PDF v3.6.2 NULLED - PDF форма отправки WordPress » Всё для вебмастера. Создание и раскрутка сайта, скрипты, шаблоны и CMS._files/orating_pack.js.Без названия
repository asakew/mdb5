var hidecomm=[],rateval=0,oleft=0,otop=0;var ogold=39,oblack=-39;(function($){$.fn.livedrag=function(opts){this.live("mouseenter",function(){if(!$(this).data("init"))$(this).data("init",true).draggable(opts);});return false;};}(jQuery));$(function(){$(".orating_res").each(function(){rateval=parseInt($(this).html());if(rateval>ogold)$(this).parent().addClass("ogold");else if(rateval>0)$(this).parent().addClass("oplus");else if(rateval<oblack)$(this).parent().addClass("oblack");else if(rateval<0)$(this).parent().addClass("ominus");});$(".ocomm_res").each(function(){rateval=parseInt($(this).html());if(rateval>0)$(this).parent().addClass("oplus");else if(rateval<0){$(this).parent().addClass("ominus");if(rateval<-4){var id=$(this).parent().attr('id').split("-");hidecomm[id[1]]=$("#comment-id-"+id[1]).html();$("#comment-id-"+id[1]).html('<div class="comm_hide">Этот комментарий получил слишком много голосов против.<a href="#" onclick="showcomm('+id[1]+');return false;">показать</a></div>');}}});$(".ostats").livedrag({handle:"h4"});$(".ostats_area .oclose").live("click",function(){$(".ostats").fadeOut(400,function(){$(this).remove();});return false;});$("#ostats-user-ratings .oclose").live("click",function(){ostat_profile_clear();return false;});$("#ostats-user-karma .oclose").live("click",function(){ostat_karma_clear();return false;});$(".orating a, .ocomm a").live({click:function(e){$(".ostats").remove();$("body").append('<div class="ostats"><div class="ostats_area"><a href="#" class="oclose" title="Закрыть"></a><h4>Статистика голосования</h4><div class="ostats_rows"></div></div></div>');oleft=e.pageX-parseInt($('.ostats').width())-35;otop=e.pageY-15;$(".ostats").css({top:otop,left:oleft});}});$(".orating_profile").live({click:function(){ostat_total_clear();$("#ostats-userinfo").remove();var href=$(this).attr('href');if(href=='#')return false;var name=$(this).html();var href=$(this).attr('href');$(".ostats_rows ul").addClass('orating_load');var list=$(this).parent();$.post(dle_root+'engine/ajax/rating_profile.php',{name:name,rating:1,skin:dle_skin},function(rateval){$(".ostats_rows ul").removeClass('orating_load');list.append("<div id='ostats-userinfo'><a href='#' onclick='orating_profile_karma(\""+name+"\");return false;' id='okarma' class='ogray' title='Карма'>"+rateval+"</a><a href='"+href+"' target='_blank'>Профиль</a><a href='#' onclick='orating_profile_log(\""+name+"\");return false;'>Оценки</a><a href='#' class='orclose'>x</a></div>");if(rateval>ogold)$("#okarma").addClass("ogold");else if(rateval>0)$("#okarma").addClass("oplus");else if(rateval<oblack)$("#okarma").addClass("oblack");else if(rateval<0)$("#okarma").addClass("ominus");$("#ostats-userinfo").fadeIn(500);});return false;}});$("#ostats-userinfo .orclose").live({click:function(){$("#ostats-userinfo").fadeOut(400,function(){$(this).remove()});ostat_total_clear();return false;}});})
function ostat_profile_clear(){$("#ostats-user-ratings").remove();$(".ostats_area").animate({marginRight:0},400);}
function ostat_karma_clear(){$("#ostats-user-karma").remove();var left=parseInt($(".ostats").css('left'))+parseInt($(".ostats_area").css('marginLeft'));$(".ostats").animate({left:left+'px'},400);$(".ostats_area").animate({marginLeft:0},400);}
function ostat_total_clear(){$("#ostats-user-ratings").remove();$("#ostats-user-karma").remove();var left=parseInt($(".ostats").css('left'))+parseInt($(".ostats_area").css('marginLeft'));$(".ostats").animate({left:left+'px'},400);$(".ostats_area").animate({marginRight:0,marginLeft:0},400);}
function orating_profile_karma(name){$("#ostats-user-karma").remove();$(".ostats_rows ul").addClass('orating_load');$.post(dle_root+'engine/ajax/rating_profile_karma.php',{name:name,skin:dle_skin},function(d){$(".ostats_rows ul").removeClass('orating_load');var height=$(".ostats_area").height()-4;var ulheight=height-$(".ostats h4").height();$(".ostats").prepend("<div id='ostats-user-karma' style='height:"+height+"px;display:none;'><a href='#' class='oclose' title='Закрыть'></a><h4>Рейтинг публикаций пользователя: <b>"+name+"</b></h4><ul style='height:"+ulheight+"px;'></ul></div>");var width=$("#ostats-user-karma").width()+parseInt($(".ostats").css('paddingLeft'));if($(".ostats_area").css('marginLeft')==width+'px')$("#ostats-user-karma").slideDown(300);else{var left=parseInt($(".ostats").css('left'));left-=width;$(".ostats").animate({left:left+'px'},500);$(".ostats_area").animate({marginLeft:width+'px'},500,function(){$("#ostats-user-karma").slideDown(300);});}
$("#ostats-user-karma ul").html(d);$(".ostats_karma_ratings_val").each(function(){rateval=parseInt($(this).html());if(rateval>ogold)$(this).addClass("ogold");else if(rateval>0)$(this).addClass("oplus");else if(rateval<oblack)$(this).addClass("oblack");else if(rateval<0)$(this).addClass("ominus");});});return false;}
function orating_profile_log(name){$("#ostats-user-ratings").remove();$(".ostats_rows ul").addClass('orating_load');$.post(dle_root+'engine/ajax/rating_profile.php',{name:name,skin:dle_skin},function(d){$(".ostats_rows ul").removeClass('orating_load');var height=$(".ostats_area").height()-4;var ulheight=height-$(".ostats h4").height();$(".ostats").prepend("<div id='ostats-user-ratings' style='height:"+height+"px;display:none;'><a href='#' class='oclose' title='Закрыть'></a><h4>Последние оценки пользователя: <b>"+name+"</b></h4><ul style='height:"+ulheight+"px;'></ul></div>");var width=$("#ostats-user-ratings").width()+parseInt($(".ostats").css('paddingRight'));if($(".ostats_area").css('marginRight')==width+'px')$("#ostats-user-ratings").slideDown(300);else{$(".ostats_area").animate({marginRight:width+'px'},500,function(){$("#ostats-user-ratings").slideDown(300);});}
$("#ostats-user-ratings ul").html(d);$(".ostats_user_ratings_val").each(function(){rateval=parseInt($(this).html());if(rateval>ogold)$(this).addClass("ogold");else if(rateval>0)$(this).addClass("oplus");else if(rateval<oblack)$(this).addClass("oblack");else if(rateval<0)$(this).addClass("ominus");});});return false;}
function ocomrate(id,rate){var area=$("#ocomm-"+id);$("body").addClass('orload');$.post(dle_root+'engine/ajax/rating_comm.php',{comm_id:id,rate:rate,skin:dle_skin},function(data){$("body").removeClass('orload');if(data.msg){$(".ostats_area h4").html("Внимание");$(".ostats_rows").html('<ul><li class="onoentry">'+data.msg+'</li></ul>');$(".ostats").slideDown(600);}else{if(data.rating>0){data.rating="+"+data.rating;area.removeClass('ominus').addClass("oplus");}else if(data.rating<0)area.removeClass('oplus').addClass("ominus");else area.removeClass('oplus').removeClass('ominus');area.find('.ocomm_res').html(data.rating);}},"json");area.find("a.orating_m, a.orating_p").addClass('orated');return false;}
function ocomstat(id,p,n){var area=$("#ocomm-"+id);$("body").addClass('orload');$(".ostats_rows").fadeTo(300,0.01);$.post(dle_root+'engine/ajax/rating_comm_stats.php',{comm_id:id,p:p},function(data){$("body").removeClass('orload');$('.ostats_rows').html(data);if(n)$(".ostats").slideDown(600);else $(".ostats_rows").stop(true,true).fadeTo(400,1);});return false;}
function orating(id,rate){var area=$("#orating-"+id);$("body").addClass('orload');$.post(dle_root+'engine/ajax/rating.php',{news_id:id,rate:rate,skin:dle_skin},function(data){$("body").removeClass('orload');if(data.msg){$(".ostats_area h4").html("Внимание");$(".ostats_rows").html('<ul><li class="onoentry">'+data.msg+'</li></ul>');$(".ostats").slideDown(600);}else{if(data.rating>ogold){data.rating="+"+data.rating;area.removeClass('ominus oplus oblack').addClass("ogold");}else if(data.rating>0){data.rating="+"+data.rating;area.removeClass('ominus ogold oblack').addClass("oplus");}else if(data.rating<oblack)area.removeClass('oplus ogold ominus').addClass("oblack");else if(data.rating<0)area.removeClass('oplus ogold oblack').addClass("ominus");else area.removeClass('oplus ominus ogold oblack');area.find(".orating_res").html(data.rating);}},"json");area.find("a.orating_m, a.orating_p").addClass('orated');return false;}
function ostats(id,p,n){var area=$("#orating-"+id);$(".ostats_rows ul").addClass('orating_load');$(".ostats_rows").fadeTo(300,0.01);ostat_profile_clear();$.post(dle_root+'engine/ajax/rating_stats.php',{news_id:id,p:p},function(data){$(".ostats_rows ul").removeClass('orating_load');$('.ostats_rows').html(data);if(n)$(".ostats").slideDown(600);else $(".ostats_rows").stop(true,true).fadeTo(400,1);});return false;}
function showcomm(id){$("#comment-id-"+id).html(hidecomm[id]);return false;}
function orating_profile_color(){var r=$("#orating_profile");var rating=parseInt(r.html());if(rating>ogold)r.addClass("ogold");else if(rating>0)r.addClass("oplus");else if(rating<oblack)r.addClass("oblack");else if(rating<0)r.addClass("ominus");}